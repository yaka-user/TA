<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <title>{{ title }}</title>
    <script>
      (() => {
        'use strict'
        const getStoredTheme = () => localStorage.getItem('theme')
        const setStoredTheme = theme => localStorage.setItem('theme', theme)
        const getPreferredTheme = () => {
          const storedTheme = getStoredTheme()
          if (storedTheme) {
            return storedTheme
          }
          return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
        }
        const setTheme = theme => {
          if (theme === 'auto') {
            document.documentElement.setAttribute('data-bs-theme', (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'))
          } else {
            document.documentElement.setAttribute('data-bs-theme', theme)
          }
        }
        setTheme(getPreferredTheme())
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
          const storedTheme = getStoredTheme()
          if (storedTheme !== 'light' && storedTheme !== 'dark') {
            setTheme(getPreferredTheme())
          }
        })
        window.addEventListener('DOMContentLoaded', () => {
          document.querySelectorAll('[data-bs-theme-value]')
            .forEach(toggle => {
              toggle.addEventListener('click', () => {
                const theme = toggle.getAttribute('data-bs-theme-value')
                setStoredTheme(theme)
                setTheme(theme)
              })
            })
        })
      })()
    </script>
</head>
<body>
    {% if current_user.is_authenticated: %}
    <header>
        <nav class="navbar bg-body-secondary">
            <div class="container-fluid">
                <a href="/" class="nav-link">„Çø„Çπ„ÇØ‰∏ÄË¶ß</a>
                <a href="/users" class="nav-link">„É¶„Éº„Ç∂„Éº‰∏ÄË¶ß</a>
                <div class="nav-item d-flex align-items-center">
                    <div class="dropdown me-3">
                        <button class="btn btn-secondary dropdown-toggle btn-sm" type="button" id="bd-theme" data-bs-toggle="dropdown" aria-expanded="false">
                            „ÉÜ„Éº„Éû
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="bd-theme">
                            <li><button type="button" class="dropdown-item" data-bs-theme-value="light">„É©„Ç§„Éà</button></li>
                            <li><button type="button" class="dropdown-item" data-bs-theme-value="dark">„ÉÄ„Éº„ÇØ</button></li>
                            <li><button type="button" class="dropdown-item" data-bs-theme-value="auto">Ëá™Âãï</button></li>
                        </ul>
                    </div>
                    <a href="#" data-bs-toggle="modal" data-bs-target="#editUserModal" class="text-decoration-none text-body me-2">
                        {{ current_user.id}} „Åï„Çì
                    </a>
                    <a href="/logout"><span class="btn btn-primary btn-sm">„É≠„Ç∞„Ç¢„Ç¶„Éà</span></a>
                </div>
            </div>
        </nav>
    </header>

    <div class="modal fade" id="editUserModal" tabindex="-1" aria-labelledby="editUserModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editUserModalLabel">„É¶„Éº„Ç∂„ÉºÊÉÖÂ†±„ÅÆÁ∑®ÈõÜ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form action="/user/update" method="post">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="id" class="form-label">„É¶„Éº„Ç∂„ÉºID</label>
                            <input type="text" class="form-control" id="id" name="id" value="{{ current_user.id }}" required>
                        </div>
                        <div class="mb-3">
                            <label for="lastname" class="form-label">Âßì</label>
                            <input type="text" class="form-control" id="lastname" name="lastname" value="{{ current_user.lastname }}" required>
                        </div>
                        <div class="mb-3">
                            <label for="firstname" class="form-label">Âêç</label>
                            <input type="text" class="form-control" id="firstname" name="firstname" value="{{ current_user.firstname }}" required>
                        </div>
                        <div class="mb-3">
                            <label for="updatePassword" class="form-label">Êñ∞„Åó„ÅÑ„Éë„Çπ„ÉØ„Éº„Éâ (Â§âÊõ¥„Åô„ÇãÂ†¥Âêà„ÅÆ„ÅøÂÖ•Âäõ)</label>
                            <div class="position-relative">
                                <input type="password" class="form-control" id="updatePassword" name="password" style="padding-right: 40px;">
                                <button type="button"
                                    class="btn btn-outline-secondary position-absolute top-50 end-0 translate-middle-y me-2"
                                    id="toggleUpdatePassword" tabindex="-1" style="padding: 4px 8px;">
                                    üëÅ
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">„Ç≠„É£„É≥„Çª„É´</button>
                        <button type="submit" class="btn btn-primary">Êõ¥Êñ∞</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    {% endif %}
    <aside>
        <div class="container-fluid">
            {% for message in get_flashed_messages() %}
            <div class="alert alert-warning alert-dismissible fade show">
                <p>{{ message }}</p>
                <span class="btn-close" data-bs-dismiss="alert" aria-label="Èñâ„Åò„Çã"></span>
            </div>
            {% endfor %}
        </div>
    </aside>
    <main>
        <div class="container-fluid" >
            {% block content %}
            {% endblock content %}
        </div>
    </main>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const togglePassword = document.getElementById("toggleUpdatePassword");
            const password = document.getElementById("updatePassword");

            if (togglePassword && password) {
                togglePassword.addEventListener("click", function () {
                    const type = password.getAttribute("type") === "password" ? "text" : "password";
                    password.setAttribute("type", type);
                    this.textContent = type === "password" ? "üëÅ" : "üôà";
                });
            }
        });
    </script>
</body>
</html>